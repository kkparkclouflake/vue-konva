(function(a,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue"),require("konva")):typeof define=="function"&&define.amd?define(["vue","konva"],p):(a=typeof globalThis<"u"?globalThis:a||self,a["vue-konva"]=p(a.Vue,a.Konva))})(this,function(a,p){"use strict";function g(o){if(!p.autoDrawEnabled){const n=o.getLayer()||o.getStage();n&&n.batchDraw()}}const k={key:!0,style:!0,elm:!0,isRootInsert:!0},N=".vue-konva-event";function w(o,n,r,d){const e=o.__konvaNode,i={};let u=!1;for(let t in r){if(k.hasOwnProperty(t))continue;const c=t.slice(0,2)==="on",v=r[t]!==n[t];if(c&&v){let s=t.slice(2).toLowerCase();s.slice(0,7)==="content"&&(s="content"+s.slice(7,1).toUpperCase()+s.slice(8)),e==null||e.off(s+N,r[t])}!n.hasOwnProperty(t)&&(e==null||e.setAttr(t,void 0))}for(let t in n){if(k.hasOwnProperty(t))continue;let c=t.slice(0,2)==="on";const v=r[t]!==n[t];if(c&&v){let f=t.slice(2).toLowerCase();f.slice(0,7)==="content"&&(f="content"+f.slice(7,1).toUpperCase()+f.slice(8)),n[t]&&(e==null||e.off(f+N),e==null||e.on(f+N,n[t]))}!c&&(n[t]!==r[t]||d&&n[t]!==(e==null?void 0:e.getAttr(t)))&&(u=!0,i[t]=n[t])}u&&e&&(e.setAttrs(i),g(e))}const A="v";function E(o){function n(r){return r!=null&&r.__konvaNode?r:r!=null&&r.parent?n(r.parent):(console.error("vue-konva error: Can not find parent node"),null)}return n(o.parent)}function m(o){return o.component?o.component.__konvaNode||m(o.component.subTree):null}function P(o){const{el:n,component:r}=o,d=m(o);if(n!=null&&n.tagName&&r&&!d){const e=n.tagName.toLowerCase();return console.error(`vue-konva error: You are trying to render "${e}" inside your component tree. Looks like it is not a Konva node. You can render only Konva components inside the Stage.`),null}return d}function T(o){const n=e=>!!(e!=null&&e.hasOwnProperty("component")),r=e=>Array.isArray(e),d=e=>n(e)?[e,...d(e.children)]:r(e)?e.flatMap(d):[];return d(o.children)}function C(o,n){const r=T(o),d=[];r.forEach(i=>{const u=P(i);u&&d.push(u)});let e=!1;d.forEach((i,u)=>{i.getZIndex()!==u&&(i.setZIndex(u),e=!0)}),e&&g(n)}const K=a.defineComponent({name:"Stage",props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},inheritAttrs:!1,setup(o,{attrs:n,slots:r,expose:d}){const e=a.getCurrentInstance();if(!e)return;const i=a.reactive({}),u=a.ref(null),t=new window.Konva.Stage({width:o.config.width,height:o.config.height,container:document.createElement("div")});e.__konvaNode=t,f();function c(){return e==null?void 0:e.__konvaNode}function v(){return e==null?void 0:e.__konvaNode}function f(){if(!e)return;const s=i||{},_={...n,...o.config};w(e,_,s,o.__useStrictMode),Object.assign(i,_)}return a.onMounted(()=>{u.value&&(u.value.innerHTML="",t.container(u.value)),f()}),a.onUpdated(()=>{f(),C(e.subTree,t)}),a.onBeforeUnmount(()=>{t.destroy()}),a.watch(()=>o.config,f,{deep:!0}),d({getStage:v,getNode:c}),()=>{var s;return a.h("div",{ref:u},(s=r.default)==null?void 0:s.call(r))}}}),L=".vue-konva-event",O={Group:!0,Layer:!0,FastLayer:!0,Label:!0};function b(o){return a.defineComponent({name:o,props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},setup(n,{attrs:r,slots:d,expose:e}){const i=a.getCurrentInstance();if(!i)return;const u=a.reactive({}),t=window.Konva[o];if(!t){console.error("vue-konva error: Can not find node "+o);return}const c=new t;i.__konvaNode=c,i.vnode.__konvaNode=c,s();function v(){return i==null?void 0:i.__konvaNode}function f(){return i==null?void 0:i.__konvaNode}function s(){if(!i)return;const l={};for(const y in i==null?void 0:i.vnode.props)y.slice(0,2)==="on"&&(l[y]=i.vnode.props[y]);const h=u||{},S={...r,...n.config,...l};w(i,S,h,n.__useStrictMode),Object.assign(u,S)}a.onMounted(()=>{var h;const l=(h=E(i))==null?void 0:h.__konvaNode;l&&"add"in l&&l.add(c),g(c)}),a.onUnmounted(()=>{g(c),c.destroy(),c.off(L)}),a.onUpdated(()=>{s(),C(i.subTree,c)}),a.watch(()=>n.config,s,{deep:!0}),e({getStage:f,getNode:v});const _=O.hasOwnProperty(o);return()=>{var l;return _?a.h("template",{},(l=d.default)==null?void 0:l.call(d)):null}}})}const x=["Arc","Arrow","Circle","Ellipse","FastLayer","Group","Image","Label","Layer","Line","Path","Rect","RegularPolygon","Ring","Shape","Sprite","Star","Tag","Text","TextPath","Transformer","Wedge"];return typeof window<"u"&&!window.Konva&&require("konva"),{install:(o,n)=>{let r=(n==null?void 0:n.prefix)||A;[K,...x.map(b)].map(d=>{o.component(`${r}${d.name}`,d)})}}});
